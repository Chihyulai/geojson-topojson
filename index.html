<!DOCTYPE html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>GeoJSON-TopoJSON</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/2.1.0/normalize.css">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css">
        <style>
          body {
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
          }
        </style>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap-responsive.min.css">
    </head>
    <body>

      <a href="https://github.com/JeffPaine/geojson-topojson"><img style="position: absolute; top: 0; right: 0; border: 0; z-index:1050;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>

        <div class="navbar navbar-inverse navbar-fixed-top">
          <div class="navbar-inner">
            <div class="container">
              <a class="brand" href="#">GeoJSON-TopoJSON</a>
            </div>
          </div>
        </div>

        <div class="container">

          <div class="row" id="error">
          </div>

            <div class="row">
                <div class="span6">
                    <h2>GeoJSON</h2>
                    <textarea class="span6" rows="20" id="geojson"></textarea>
                    <button class="btn btn-large btn-primary" id="convert-to-topojson" type="button">Convert to TopoJSON <i class="icon-arrow-right icon-white"></i></button>
                </div>
                <div class="span6">
                    <h2>TopoJSON</h2>
                    <textarea class="span6" rows="20" id="topojson"></textarea>
                    <button class="btn btn-large btn-primary" id="convert-to-geojson" type="button"><i class="icon-arrow-left icon-white"></i> Convert to GeoJSON</button>
                    <br><span>* Your TopoJSON geo object must be under <code>&lt;objectName&gt;.objects.collection</code></span>
                </div>
            </div>

          <div class="row">
            <footer>
              <hr>
              <p class="pull-right text-right">Crafted with love and &#8984;-R by <a href="https://twitter.com/japaine">Jeff Paine</a>.</p>
            </footer>
          </div>

        </div> <!-- END container -->

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap-alert.js"></script>
        <script src="lib.js"></script>
        <script>
            // Click handler for our convert to TopoJSON button
            $('#convert-to-topojson').click(function() {
              var geojsonString = $('#geojson').val()
              // Clear the contents of our TopoJSON textarea
              $('#topojson').val('');

              if (geojsonString === '') {
                // Ignore empty submissions
              } else {
                convertGeojsonToTopojson(geojsonString);
              }
            });


            // Click handler for our convert to GeoJSON button
            $('#convert-to-geojson').click(function() {
              var topojsonString = $('#topojson').val()
              // Clear the contents of our GeoJSON textarea
              $('#geojson').val('');

              if (topojsonString === '') {
                // Ignore empty submissions
              } else {
                convertTopojsonToGeojson(topojsonString);
              }
            });


            // Convert the given GeoJSON to TopoJSON
            var convertGeojsonToTopojson = function(geojsonString) {
                var parsedGeojson = JSON.parse(geojsonString)
                var topojsonOutput = topojson.topology({collection: parsedGeojson});
                $('#topojson').val(JSON.stringify(topojsonOutput, null, 4));
            };


            // Convert the given TopoJSON to GeoJSON
            var convertTopojsonToGeojson = function(topojsonString) {
              try {
                var parsedTopojson = JSON.parse(topojsonString);
                var geojson = topojson.feature(parsedTopojson, parsedTopojson.objects.collection);
                $('#geojson').val(JSON.stringify(geojson, null, 4));
              }

              catch (error) {
                displayError('There was an unknown error converting your TopoJSON to GeoJSON. Sorry.');
                console.log(error, error.message);
              }
            };

            // Make our error alert box closable
            $(".alert").alert();

            // Display errors to the user
            var displayError = function(errorText) {
              var html = '<div class="span12 alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button><b>Error: </b> ';
              html += errorText;
              html += '</div>';
              $('#error').html(html);
            };
        </script>
    </body>
</html>
