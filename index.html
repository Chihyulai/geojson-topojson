<!DOCTYPE html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>GeoJSON-TopoJSON</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/2.1.0/normalize.css">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css">
        <style>
          body {
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
          }
        </style>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap-responsive.min.css">
    </head>
    <body>

        <div class="navbar navbar-inverse navbar-fixed-top">
          <div class="navbar-inner">
            <div class="container">
              <a class="brand" href="#">GeoJSON-TopoJSON</a>
            </div>
          </div>
        </div>

        <div class="container">

          <div class="row" id="error">
          </div>

            <div class="row">
                <div class="span6">
                    <h2>GeoJSON</h2>
                    <textarea class="span6" rows="20" id="geojson"></textarea>
                    <button class="btn btn-large btn-primary" id="convert-button" type="button">Convert to TopoJSON <i class="icon-random icon-white"></i></button>
                </div>
                <div class="span6">
                    <h2>TopoJSON</h2>
                    <textarea class="span6" rows="20" id="topojson" readonly></textarea>
                </div>
            </div>

          <div class="row">
            <footer>
              <hr>
              <p class="pull-right text-right">Crafted with love and &#8984;-R by <a href="https://twitter.com/japaine">Jeff Paine</a>.</p>
            </footer>
          </div>

        </div> <!-- END container -->

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap-alert.js"></script>
        <script>
            // Click handler for our convert button
            $('#convert-button').click(function() {
              var geojson = $('#geojson').val()
              // Clear the contents of our TopoJSON textarea
              $('#topojson').val('');

              if (geojson === '') {
                // Ignore empty submissions
              } else {
                convertGeojsonToTopojson(geojson)
              }
            });

            // Convert the given GeoJSON to TopoJSON
            var convertGeojsonToTopojson = function(geojson) {
                $.ajax({
                  url: '/',
                  type: "POST",
                  data: geojson,
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  success: function(data) {
                    $('#topojson').val(JSON.stringify(data, null, 4));
                  },
                  error: function() {
                    displayError('There was an unknown error converting your GeoJSON to TopoJSON. Sorry.');
                  }
                })
            };

            // Make our error alert box closable
            $(".alert").alert()

            // Display errors to the user
            var displayError = function(errorText) {
              var html = '<div class="span12 alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button><b>Error: </b> '
              html += errorText
              html += '</div>'
              $('#error').html(html);
            };
        </script>
    </body>
</html>
